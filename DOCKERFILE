# Use Node.js 20 Slim (Debian-based)
# "Slim" is better than Alpine for Music Bots because it includes standard libraries needed by FFmpeg
FROM node:20-slim

# Install build tools required for compiling native audio modules (Opus/Sodium)
# We also ensure python3 is available as 'python' for node-gyp
RUN apt-get update && apt-get install -y \
    python3 \
    make \
    g++ \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Set the working directory
WORKDIR /app

# Copy dependency files first to leverage Docker caching
COPY package.json yarn.lock* ./

# Install dependencies
# We use --frozen-lockfile to ensure exact versions from yarn.lock are installed
RUN yarn install --production --frozen-lockfile

# Copy the rest of the bot code
COPY . .

# Start the bot using the command you requested
CMD ["yarn", "start"]